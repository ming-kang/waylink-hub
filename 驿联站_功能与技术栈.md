# 驿联站 - 智慧公交站项目

## 项目概述

面向游客与居民的多功能城市公共服务终端，提供智能寄存、跨站转运、快充与公益WiFi服务。

---

## 一、前端

### 方案调整说明

**原方案**：微信小程序 → **现方案**：网页版 + VPS

原因：微信小程序开发审核周期长，测试版无法在验收现场公开展示；网页版开发完成即可通过浏览器直接演示，更适合验收场景。

### 产品形态

| 产品 | 定位 | 技术栈 |
|-----|------|--------|
| 网页端（用户端） | C端用户入口 | HTML / CSS / JavaScript |
| 网页端（运维端） | 运维管理入口 | HTML / CSS / JavaScript |
| 部署方式 | VPS 服务器 | 任意云服务器（10-30元/月） |

### 功能模块

#### 用户端
- 储物柜预约
- 跨站转运下单
- 使用状态查询
- 故障反馈提交

#### 运维端
- 设备运行状态监控
- 数据统计分析
- 路径优化建议生成
- 故障预警与处理

### 技术选型

| 类别 | 技术 |
|-----|------|
| 页面开发 | HTML5 / CSS3 / JavaScript (ES6+) |
| HTTP 请求 | Fetch API / Axios |
| 部署平台 | VPS (Linux + Nginx/Gunicorn) |
| 认证方式 | 账号密码登录 / 无感WiFi认证 |

---

## 二、后端

### 技术栈

| 类别 | 技术/框架 |
|-----|----------|
| 开发语言 | Python |
| Web框架 | （未明确） |
| 接口规范 | RESTful API |
| 数据库 | （未明确） |
| 运维平台 | 远程运维管理平台 |

### 核心功能

| 模块 | 功能描述 |
|-----|----------|
| 用户管理 | 用户认证、权限管理 |
| 订单管理 | 储物预约、转运下单、状态追踪 |
| 数据分析 | 使用频率统计、高峰时段分析、路径优化 |
| 运维支撑 | 设备监控、故障预警、远程管理 |
| 路径规划 | 转运路线优化算法 |

### 架构模块

```
┌─────────────────────────────────────┐
│          微信小程序 (前后端交互)       │
├─────────────────────────────────────┤
│          Python 后台服务              │
│  ┌─────────┐  ┌─────────────────┐   │
│  │ 用户模块 │  │ 订单模块         │   │
│  └─────────┘  └─────────────────┘   │
│  ┌─────────┐  ┌─────────────────┐   │
│  │ 数据分析 │  │ 运维管理模块     │   │
│  └─────────┘  └─────────────────┘   │
│  ┌───────────────────────────────┐   │
│  │ 路径规划算法（转运优化）        │   │
│  └───────────────────────────────┘   │
└─────────────────────────────────────┘
```

---

## 三、硬件

### 设备清单

| 设备 | 型号/规格 | 参考价格 | 用途 |
|-----|----------|---------|------|
| 主控 | ESP32 开发板 | 40-60元 | 嵌入式控制中心 + WiFi |
| 摄像头 | ESP32-CAM | 20-30元 | 人脸识别拍照（可选） |
| 读卡器 | RC522 / PN532 | 15-25元 | 刷卡身份验证 |
| 继电器 | 5V继电器模块 | 5-10元 | 储物柜门控 |
| 传感器 | 轻触开关/红外传感器 | 5-10元 | 检测柜内物品状态 |
| 电源 | 5V/2A 电源适配器 | 15-20元 | 供电 |

> **参考总价**：约 100-150 元

### 功能可行性

| 功能 | 可行性 | 说明 |
|-----|--------|------|
| 继电器控制 | ✅ 可行 | 充足GPIO口，直接控制 |
| 传感器读取 | ✅ 可行 | 数字/模拟输入 |
| NFC刷卡 | ✅ 可行 | SPI/I2C通信 |
| WiFi通信 | ✅ 可行 | 内置2.4GHz WiFi，直接HTTP |
| 人脸识别 | ⚠️ 云端推荐 | 拍照上传VPS处理 |
| 路径规划 | ❌ 不可行 | 需云端VPS执行 |

### 系统架构

```
┌─────────────────────────────────────────────────────┐
│                     VPS (云端)                       │
│  ┌──────────┐  ┌──────────┐  ┌──────────────────┐  │
│  │ Python   │  │ 人脸识别 │  │ 路径规划/数据分析│  │
│  │ 后端API  │  │ (云端)   │  │                  │  │
│  └──────────┘  └──────────┘  └──────────────────┘  │
└────────────────────────┬────────────────────────────┘
                         │ HTTP RESTful API
┌────────────────────────┴────────────────────────────┐
│                    ESP32                              │
│  ┌─────────┐  ┌─────────┐  ┌─────────────────────┐  │
│  │ 继电器  │  │ 传感器  │  │ WiFi (2.4GHz)       │  │
│  │ 控制    │  │ 读取    │  │ 直接HTTP请求        │  │
│  └─────────┘  └─────────┘  └─────────────────────┘  │
│  ┌────────────────────────────────────────────────┐ │
│  │ 可选：ESP32-CAM 拍照 → 上传云端识别            │ │
│  └────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────┘
```

### ESP32 开发指南

#### 什么是 ESP32？

ESP32 是乐鑫科技（Espressif）推出的低功耗 WiFi+蓝牙双模 SoC，集成以下核心资源：

| 资源 | 规格 |
|-----|------|
| CPU | 双核 240MHz Xtensa LX6 |
| 内存 | 520KB SRAM |
| 存储 | 4MB-16MB Flash |
| WiFi | 2.4GHz 802.11 b/g/n |
| 蓝牙 | BLE 4.2 / BT |
| GPIO | 34个可编程引脚 |
| 通信接口 | SPI, I2C, UART, ADC, DAC等 |

#### 开发方式（语言选择）

| 方式 | 语言 | 推荐度 | 说明 |
|-----|------|--------|------|
| **Arduino IDE** | C++ | ⭐⭐⭐⭐ | 资料最多，UNO用户友好 |
| **PlatformIO** | C++ | ⭐⭐⭐⭐⭐ | 专业IoT开发，VS Code插件 |
| **MicroPython** | Python | ⭐⭐⭐⭐ | 对Python开发者友好，入门快 |
| **ESP-IDF** | C | ⭐⭐⭐ | 官方原生框架，功能最强但学习曲线陡 |

**推荐方案**：如果熟悉 Arduino C++，用 **Arduino IDE**；如果 Python 熟练，用 **MicroPython**。

#### 开发环境搭建（Arduino IDE 方案）

1. **安装 Arduino IDE**
   - 下载地址：https://www.arduino.cc/en/software

2. **安装 ESP32 开发板**
   - 打开 Arduino IDE → 文件 → 首设置
   - 在"附加开发板管理器网址"中添加：
     ```
     https://raw.githubusercontent.com/espressif/arduino-esp32/gh-pages/package_esp32_index.json
     ```
   - 工具 → 开发板 → 开发板管理器 → 搜索 "ESP32" → 安装

3. **选择开发板型号**
   - 工具 → 开发板 → ESP32 Arduino → 选择 `ESP32 Dev Module`

4. **测试代码（Blink）**
   ```cpp
   void setup() {
     pinMode(2, OUTPUT);  // 板载LED
   }
   void loop() {
     digitalWrite(2, HIGH);
     delay(1000);
     digitalWrite(2, LOW);
     delay(1000);
   }
   ```

#### ESP32 与云端通信示例

```cpp
#include <WiFi.h>
#include <HTTPClient.h>

const char* ssid = "你的WiFi名称";
const char* password = "你的WiFi密码";
const char* serverUrl = "http://你的VPS地址/api/device/status";

void setup() {
  Serial.begin(115200);
  WiFi.begin(ssid, password);
  while (WiFi.status() != WL_CONNECTED) {
    delay(1000);
    Serial.println("连接WiFi中...");
  }
}

void loop() {
  if (WiFi.status() == WL_CONNECTED) {
    HTTPClient http;
    http.begin(serverUrl);
    http.addHeader("Content-Type", "application/json");

    // 发送传感器数据
    String payload = "{\"device_id\":1,\"status\":\"open\"}";
    int httpCode = http.POST(payload);

    http.end();
  }
  delay(5000);
}
```

#### 可能遇到的难点

| 难点 | 原因 | 解决方案 |
|-----|------|---------|
| **首次连接WiFi** | ESP32没有屏幕，无法可视化配置 | 使用SmartConfig（手机配网）或预设WiFi信息 |
| **供电不稳定** | ESP32工作电流较大 | 使用 5V/2A 电源，避免直接用电脑USB供电 |
| **IO口电压** | ESP32工作电压3.3V | 继电器、传感器需确认电平匹配，或用电平转换模块 |
| **程序上传失败** | 驱动或端口问题 | 安装 CH340/CP2102 驱动，按住BOOT键再上传 |
| **WiFi断线** | 路由器或信号问题 | 实现断线重连机制，增加看门狗 |
| **引脚复用** | 多个设备共用SPI/I2C | 合理规划引脚，避免冲突 |
| **串口调试** | 只有一个硬件串口 | 可用软串口SoftwareSerial或蓝牙调试 |

#### 推荐学习资源

| 资源类型 | 推荐内容 |
|---------|---------|
| 入门教程 | B站搜索 "ESP32 Arduino教程" |
| 官方文档 | https://docs.espressif.com/projects/arduino-esp32/ |
| 示例代码 | Arduino IDE → 文件 → 示例 → ESP32 |
| 社区支持 | ESP32中文论坛、CSDN、知乎 |
| 硬件购买 | 淘宝搜索 "ESP32 DevKit" 或 "ESP32 WROOM" |

#### 未来复用价值

ESP32 是 IoT 领域最流行的平台之一，学习后可拓展到：

- 智能家居网关
- 环境监测设备
- 可穿戴设备
- 蓝牙Mesh网络
- 语音助手
- WiFi定位系统

**结论**：ESP32 性价比高、学习资料丰富、未来项目通用，是本项目的最佳选择。

---

## 四、系统整体架构

```
┌────────────────────────────────────────────────────────────┐
│                      微信小程序                              │
│           (用户端)                    (运维端)              │
└────────────────────────┬───────────────────────────────────┘
                         │ HTTP/HTTPS (RESTful API)
┌────────────────────────┴───────────────────────────────────┐
│                      Python 后端                            │
│  ┌──────────┐  ┌──────────┐  ┌────────────────────────┐   │
│  │ 用户服务 │  │ 订单服务 │  │ 运维与数据分析服务      │   │
│  └──────────┘  └──────────┘  └────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 路径规划算法                                         │   │
│  └─────────────────────────────────────────────────────┘   │
└────────────────────────┬───────────────────────────────────┘
                         │ IoT 通信
┌────────────────────────┴───────────────────────────────────┐
│                   硬件层 (边缘节点)                          │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ ESP32 + 储物柜 + 传感器 + 快充 + WiFi                │   │
│  └─────────────────────────────────────────────────────┘   │
└────────────────────────────────────────────────────────────┘
```

---

## 五、团队分工

| 成员 | 负责方向 |
|-----|----------|
| 方明康 | 后端开发 + 项目协调 |
| 陈卓 | 软硬件集成（嵌入式） |
| 陈鹏宇 | 前端设计 + 用户研究 |
